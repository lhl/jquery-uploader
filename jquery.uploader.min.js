(function($,window,document,undefined){$.fn.uploader=function(options){var uploader;var opts=$.extend({},$.fn.uploader.options,options);var r={status:"ok",msg:""};var html="";html+="<input type='file' class='uploader-fileinput' style='position: absolute; visibility: hidden; height: 0; width: 0; top: 0; left: 0'>";if(opts["thumbnail"]){html+="<div class='uploader-preview'><img class='thumbnail' src='"+opts["thumbnail"]+"'></div>"}else{html+="<div class='uploader-preview'></div>"}if(opts["instructions"]){html+="<div class='uploader-instructions'>"+opts["instructions"]+"</div>"}html+="<progress class='uploader-progress' max='100'></progress>";this.append(html);$(".uploader-fileinput",this).on("change",function(e){if(this.files.length){process(this.files[0])}});this.on("click",function(e){uploader=this;$(".uploader-fileinput",uploader)[0].click()});this.on({dragover:function(e){e.preventDefault();e.stopPropagation()},dragenter:function(e){e.preventDefault();e.stopPropagation()},drop:function(e){uploader=this;e.preventDefault();e.stopPropagation();drop(e.originalEvent.dataTransfer.files)}});function error(err){if(err){r=err}if(r["status"]=="ok"){return false}else{if(err&&err["msg"]){opts["onError"].call(undefined,err)}return true}}function drop(files){if(!files.length){return}r=process(files[0])}function process(file){if(!opts["accept"][file.type]){error({status:"filetypecheck",msg:"The file must be of the type: "+$.map(opts["accept"],function(value){return value}).join(", ")});return}var reader=new FileReader;reader.onload=function(event){var image=new Image;image.src=event.target.result;image.onload=function(){var w=this.width,h=this.height,t=file.type,n=file.name,s=~~(file.size/1024)+"KB";if(opts["size"]["width"]){if(w!=opts["size"]["width"]){error({status:"sizecheck",msg:"The file width must be: "+opts["size"]["width"]});return}}if(opts["size"]["height"]){if(h!=opts["size"]["height"]){error({status:"sizecheck",msg:"The file height must be: "+opts["size"]["height"]});return}}if(opts["size"]["max-width"]){if(w>=opts["size"]["max-width"]){error({status:"sizecheck",msg:"The file width must not exceed: "+opts["size"]["max-width"]});return}}if(opts["size"]["max-height"]){if(h>opts["size"]["max-height"]){error({status:"sizecheck",msg:"The file height must not exceed: "+opts["size"]["max-height"]});return}}$(".uploader-preview",uploader).html("<img class='thumbnail' src='"+image.src+"'>");upload(file)}};reader.readAsDataURL(file)}function upload(file){progress=$("progress",uploader)[0];progress.value=0;$(progress).slideDown();var form=new FormData;form.append(opts["name"],file);for(k in opts["fields"]){form.append(k,opts["fields"][k])}var xhr=new XMLHttpRequest;xhr.open(opts["method"],opts["url"]);xhr.onload=function(){progress.value=100;$(progress).slideUp()};xhr.upload.onprogress=function(event){if(event.lengthComputable){progress.value=event.loaded/event.total*100|0}};xhr.send(form)}};$.fn.uploader.options={url:null,method:"POST",fields:{},name:"file",accept:{"image/png":"PNG","image/gif":"GIF","image/jpeg":"JPEG"},size:{},instructions:"Drag and Drop or Click",thumbnail:null,onError:function(error){alert(error["msg"])}}})(jQuery,window,document);